<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airbnb Listings Portfolio Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .summary-card h3 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .summary-card p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            background: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 500;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: #3498db;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group label {
            font-weight: 500;
            color: #2c3e50;
            margin-right: 5px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .property-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .property-header {
            padding: 20px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        .property-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .property-location {
            opacity: 0.9;
            font-size: 1rem;
        }

        .property-body {
            padding: 20px;
        }

        .property-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .pms-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pms-airbnb {
            background: #ff5a5f;
            color: white;
        }

        .pms-vrbo {
            background: #3f51b5;
            color: white;
        }

        .status-indicators {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-hidden {
            background: #95a5a6;
            color: white;
        }

        .status-active {
            background: #27ae60;
            color: white;
        }

        .status-push-enabled {
            background: #3498db;
            color: white;
        }

        .status-push-disabled {
            background: #e74c3c;
            color: white;
        }

        .performance-indicators {
            margin-top: 20px;
            border-top: 1px solid #ecf0f1;
            padding-top: 20px;
        }

        .mpi-indicator {
            text-align: center;
            margin-bottom: 15px;
        }

        .mpi-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }

        .mpi-excellent { color: #2d5a2d; }
        .mpi-good { color: #4a7c59; }
        .mpi-average { color: #f39c12; }
        .mpi-poor { color: #e67e22; }
        .mpi-critical { color: #e74c3c; }
        .mpi-unavailable { color: #95a5a6; }

        .revenue-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .revenue-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .revenue-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .revenue-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .analytics-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            padding: 25px;
        }

        .analytics-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .chart-placeholder {
            height: 200px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ecf0f1 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-style: italic;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        .data-table th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .unavailable {
            color: #95a5a6;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
        }

        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px 20px;
            border: 2px solid #ecf0f1;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 15px;
            }

            .properties-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .tabs {
                flex-direction: column;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            .property-details {
                grid-template-columns: 1fr;
            }
        }

        .comparison-arrow {
            display: inline-block;
            margin-left: 5px;
            font-weight: bold;
        }

        .arrow-up { color: #27ae60; }
        .arrow-down { color: #e74c3c; }
        .arrow-neutral { color: #95a5a6; }

        .percentage-change {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .change-positive { color: #27ae60; }
        .change-negative { color: #e74c3c; }
        .change-neutral { color: #95a5a6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Airbnb Listings Portfolio Dashboard</h1>
            <p>Real-time analytics and performance insights for your property portfolio</p>
        </div>

        <div class="summary-cards" id="summaryCards">
            <!-- Summary cards will be populated by JavaScript -->
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('overview')">Properties Overview</button>
            <button class="tab-button" onclick="showTab('analytics')">Performance Analytics</button>
            <button class="tab-button" onclick="showTab('revenue')">Revenue Deep Dive</button>
            <button class="tab-button" onclick="showTab('operations')">Operational Management</button>
        </div>

        <div id="overview" class="tab-content active">
            <div class="filters">
                <div class="filter-group">
                    <label>Search:</label>
                    <input type="text" class="search-box" placeholder="Search by property name or location..." onkeyup="filterProperties()">
                    
                    <label>PMS:</label>
                    <select id="pmsFilter" onchange="filterProperties()">
                        <option value="">All</option>
                        <option value="airbnb">Airbnb</option>
                        <option value="vrbo">VRBO</option>
                    </select>
                    
                    <label>Bedrooms:</label>
                    <select id="bedroomsFilter" onchange="filterProperties()">
                        <option value="">All</option>
                        <option value="1">1 Bedroom</option>
                        <option value="2">2 Bedrooms</option>
                        <option value="3">3 Bedrooms</option>
                        <option value="4">4 Bedrooms</option>
                        <option value="5+">5+ Bedrooms</option>
                    </select>
                    
                    <label>Status:</label>
                    <select id="statusFilter" onchange="filterProperties()">
                        <option value="">All</option>
                        <option value="active">Active</option>
                        <option value="hidden">Hidden</option>
                    </select>
                </div>
            </div>

            <div class="properties-grid" id="propertiesGrid">
                <!-- Properties will be populated by JavaScript -->
            </div>
        </div>

        <div id="analytics" class="tab-content">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>MPI Distribution</h3>
                    <div class="chart-placeholder">Market Performance Index Chart</div>
                </div>
                <div class="analytics-card">
                    <h3>Occupancy vs Market</h3>
                    <div class="chart-placeholder">Occupancy Comparison Chart</div>
                </div>
                <div class="analytics-card">
                    <h3>Revenue Trends</h3>
                    <div class="chart-placeholder">Revenue Timeline Chart</div>
                </div>
                <div class="analytics-card">
                    <h3>Top Performers</h3>
                    <table class="data-table" id="topPerformersTable">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>MPI</th>
                                <th>Revenue (30d)</th>
                            </tr>
                        </thead>
                        <tbody id="topPerformersBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="revenue" class="tab-content">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Revenue Performance Matrix</h3>
                    <div id="revenueMatrix">
                        <!-- Revenue comparison cards will be populated here -->
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>Year-over-Year Comparison</h3>
                    <div class="chart-placeholder">YoY Revenue Comparison Chart</div>
                </div>
            </div>
        </div>

        <div id="operations" class="tab-content">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Push Status Overview</h3>
                    <div id="pushStatusOverview">
                        <!-- Push status summary will be populated here -->
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>Data Quality Issues</h3>
                    <div id="dataQualityIssues">
                        <!-- Data quality issues will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data embedded from the API response
        const sampleData = {
            "listings": [
                {
                    "id": "634197676956646902",
                    "pms": "airbnb",
                    "name": "PAG12161 · Mountaintop Estate: Pool-Hot Tub-Theatre-Tiki Bar",
                    "latitude": "32.87385941",
                    "longitude": "-116.93099213",
                    "country": "United States",
                    "city_name": "Lakeside",
                    "state": "California",
                    "no_of_bedrooms": 5,
                    "min": 400,
                    "base": 891,
                    "max": 1750,
                    "group": null,
                    "subgroup": null,
                    "tags": "CJ,Pagosa",
                    "notes": null,
                    "isHidden": true,
                    "push_enabled": false,
                    "last_date_pushed": "2025-09-10T19:03:52.000Z",
                    "occupancy_next_7": "100 %",
                    "market_occupancy_next_7": "46 %",
                    "occupancy_next_30": "100 %",
                    "market_occupancy_next_30": "38 %",
                    "occupancy_next_60": "100 %",
                    "market_occupancy_next_60": "31 %",
                    "mpi_next_30": 2.6,
                    "adr_past_90": 974,
                    "stly_adr_past_90": 1221,
                    "min_prices_next_30": "Unavailable",
                    "revenue_past_30": 3440,
                    "stly_revenue_past_30": 10491,
                    "revenue_next_30": 441,
                    "stly_revenue_next_30": 15760,
                    "revenue_next_180": 4389,
                    "stly_revenue_next_180": 69957,
                    "last_booked_date": "2025-09-02T00:00:00.000Z",
                    "booking_pickup_past_30": 2,
                    "adr_next_180": 549,
                    "stly_adr_next_180": 760,
                    "mpi_next_60": 3.2,
                    "mpi_next_90": 4.0,
                    "mpi_next_120": 4.5,
                    "mpi_next_180": 6.1,
                    "recommended_base_price": 891,
                    "last_refreshed_at": "2025-09-10T19:03:51+00:00"
                },
                {
                    "id": "750684369623859183",
                    "pms": "airbnb",
                    "name": "Felton 1b (#2) · Charming 1b/1b with Full Kitchen and outdoor Patio",
                    "latitude": "32.7581635",
                    "longitude": "-117.120703",
                    "country": "United States",
                    "city_name": "San Diego",
                    "state": "California",
                    "no_of_bedrooms": 1,
                    "min": 109,
                    "base": 139,
                    "max": 217,
                    "group": null,
                    "subgroup": null,
                    "tags": "CJ",
                    "notes": null,
                    "isHidden": true,
                    "push_enabled": false,
                    "last_date_pushed": "2025-09-10T19:04:03.000Z",
                    "occupancy_next_7": "43 %",
                    "market_occupancy_next_7": "51 %",
                    "occupancy_next_30": "20 %",
                    "market_occupancy_next_30": "39 %",
                    "occupancy_next_60": "10 %",
                    "market_occupancy_next_60": "29 %",
                    "mpi_next_30": 0.5,
                    "adr_past_90": 126,
                    "stly_adr_past_90": 120,
                    "min_prices_next_30": "75 %",
                    "revenue_past_30": 920,
                    "stly_revenue_past_30": 2599,
                    "revenue_next_30": 0,
                    "stly_revenue_next_30": 2032,
                    "revenue_next_180": 0,
                    "stly_revenue_next_180": 13397,
                    "last_booked_date": "2025-08-08T00:00:00.000Z",
                    "booking_pickup_past_30": 17,
                    "adr_next_180": 0,
                    "stly_adr_next_180": 85,
                    "mpi_next_60": 0.4,
                    "mpi_next_90": 0.3,
                    "mpi_next_120": 1.7,
                    "mpi_next_180": 4.2,
                    "recommended_base_price": 139,
                    "last_refreshed_at": "2025-09-10T19:04:02+00:00"
                },
                {
                    "id": "862371806629437889",
                    "pms": "airbnb",
                    "name": "Santa Clara · Steps from beach, Newly Renovated!",
                    "latitude": "32.7826288",
                    "longitude": "-117.2528902",
                    "country": "United States",
                    "city_name": "San Diego",
                    "state": "California",
                    "no_of_bedrooms": 4,
                    "min": 441,
                    "base": 900,
                    "max": 1800,
                    "group": null,
                    "subgroup": null,
                    "tags": "mike,austin",
                    "notes": null,
                    "isHidden": true,
                    "push_enabled": false,
                    "last_date_pushed": "2025-09-10T19:04:07.000Z",
                    "occupancy_next_7": "57 %",
                    "market_occupancy_next_7": "53 %",
                    "occupancy_next_30": "23 %",
                    "market_occupancy_next_30": "49 %",
                    "occupancy_next_60": "12 %",
                    "market_occupancy_next_60": "39 %",
                    "mpi_next_30": 0.5,
                    "adr_past_90": 1387,
                    "stly_adr_past_90": 868,
                    "min_prices_next_30": "17 %",
                    "revenue_past_30": 6235,
                    "stly_revenue_past_30": 8703,
                    "revenue_next_30": 1964,
                    "stly_revenue_next_30": 12439,
                    "revenue_next_180": 4829,
                    "stly_revenue_next_180": 37761,
                    "last_booked_date": "2025-09-09T00:00:00.000Z",
                    "booking_pickup_past_30": 12,
                    "adr_next_180": 690,
                    "stly_adr_next_180": 629,
                    "mpi_next_60": 0.3,
                    "mpi_next_90": 0.3,
                    "mpi_next_120": 0.3,
                    "mpi_next_180": 0.3,
                    "recommended_base_price": 878,
                    "last_refreshed_at": "2025-09-10T19:04:06+00:00"
                },
                {
                    "id": "_units_0004_ab461356-270a-4e48-995e-f7a2c02bda02",
                    "pms": "vrbo",
                    "name": "Steps from Beach Newly renovated! ·  --- Steps from Beach Newly renovated! (3340667)",
                    "latitude": "32.7826288",
                    "longitude": "-117.2528902",
                    "country": "United States",
                    "city_name": "San Diego",
                    "state": "California",
                    "no_of_bedrooms": 4,
                    "min": 441,
                    "base": 900,
                    "max": 1800,
                    "group": null,
                    "subgroup": null,
                    "tags": null,
                    "notes": null,
                    "isHidden": true,
                    "push_enabled": false,
                    "last_date_pushed": null,
                    "occupancy_next_7": null,
                    "market_occupancy_next_7": "Unavailable",
                    "occupancy_next_30": null,
                    "market_occupancy_next_30": "Unavailable",
                    "occupancy_next_60": null,
                    "market_occupancy_next_60": "Unavailable",
                    "mpi_next_30": null,
                    "adr_past_90": null,
                    "stly_adr_past_90": "Unavailable",
                    "min_prices_next_30": null,
                    "revenue_past_30": null,
                    "stly_revenue_past_30": "Unavailable",
                    "revenue_next_30": null,
                    "stly_revenue_next_30": "Unavailable",
                    "revenue_next_180": null,
                    "stly_revenue_next_180": "Unavailable",
                    "last_booked_date": "No Booking",
                    "booking_pickup_past_30": null,
                    "adr_next_180": null,
                    "stly_adr_next_180": "Unavailable",
                    "mpi_next_60": null,
                    "mpi_next_90": null,
                    "mpi_next_120": null,
                    "mpi_next_180": null,
                    "recommended_base_price": "Unavailable",
                    "last_refreshed_at": null
                },
                {
                    "id": "4305303",
                    "pms": "airbnb",
                    "name": "Chic 1BR in Trendy Walkable South Park",
                    "latitude": "32.72383499",
                    "longitude": "-117.13231659",
                    "country": "United States",
                    "city_name": "San Diego",
                    "state": "California",
                    "no_of_bedrooms": 1,
                    "min": 109,
                    "base": 175,
                    "max": 400,
                    "group": null,
                    "subgroup": null,
                    "tags": "Jill,verified",
                    "notes": null,
                    "isHidden": false,
                    "push_enabled": true,
                    "last_date_pushed": "2025-09-16T19:03:49.000Z",
                    "occupancy_next_7": "86 %",
                    "market_occupancy_next_7": "47 %",
                    "occupancy_next_30": "40 %",
                    "market_occupancy_next_30": "34 %",
                    "occupancy_next_60": "20 %",
                    "market_occupancy_next_60": "26 %",
                    "mpi_next_30": 1.2,
                    "adr_past_90": 151,
                    "stly_adr_past_90": 159,
                    "min_prices_next_30": "28 %",
                    "revenue_past_30": 2941,
                    "stly_revenue_past_30": 994,
                    "revenue_next_30": 1741,
                    "stly_revenue_next_30": 3190,
                    "revenue_next_180": 1741,
                    "stly_revenue_next_180": 15920,
                    "last_booked_date": "2025-09-14T00:00:00.000Z",
                    "booking_pickup_past_30": 21,
                    "adr_next_180": 145,
                    "stly_adr_next_180": 124,
                    "mpi_next_60": 0.8,
                    "mpi_next_90": 0.6,
                    "mpi_next_120": 0.6,
                    "mpi_next_180": 0.5,
                    "recommended_base_price": 175,
                    "last_refreshed_at": "2025-09-16T19:03:48+00:00"
                }
            ]
        };

        let currentData = sampleData.listings;
        let filteredData = [...currentData];

        // Utility functions
        function formatCurrency(value) {
            if (value === null || value === undefined || value === "Unavailable" || value === "-") {
                return "—";
            }
            return `$${value.toLocaleString()}`;
        }

        function formatPercentage(value) {
            if (value === null || value === undefined || value === "Unavailable" || value === "-") {
                return "—";
            }
            if (typeof value === 'string' && value.includes('%')) {
                return value;
            }
            return `${value}%`;
        }

        function getMPIClass(mpi) {
            if (!mpi || mpi === null || mpi === "Unavailable") return 'mpi-unavailable';
            if (mpi >= 2.0) return 'mpi-excellent';
            if (mpi >= 1.5) return 'mpi-good';
            if (mpi >= 0.8) return 'mpi-average';
            if (mpi >= 0.5) return 'mpi-poor';
            return 'mpi-critical';
        }

        function getChangeArrow(current, previous) {
            if (!current || !previous || current === "Unavailable" || previous === "Unavailable") {
                return '<span class="comparison-arrow arrow-neutral">—</span>';
            }
            if (current > previous) {
                return '<span class="comparison-arrow arrow-up">↑</span>';
            } else if (current < previous) {
                return '<span class="comparison-arrow arrow-down">↓</span>';
            }
            return '<span class="comparison-arrow arrow-neutral">→</span>';
        }

        function calculatePercentageChange(current, previous) {
            if (!current || !previous || current === "Unavailable" || previous === "Unavailable") {
                return "—";
            }
            const change = ((current - previous) / previous) * 100;
            const className = change > 0 ? 'change-positive' : change < 0 ? 'change-negative' : 'change-neutral';
            const sign = change > 0 ? '+' : '';
            return `<span class="percentage-change ${className}">${sign}${change.toFixed(1)}%</span>`;
        }

        // Initialize dashboard
        function initializeDashboard() {
            generateSummaryCards();
            displayProperties();
            generateAnalytics();
            generateRevenueMatrix();
            generateOperationalData();
        }

        // Generate summary cards
        function generateSummaryCards() {
            const totalProperties = currentData.length;
            const airbnbCount = currentData.filter(p => p.pms === 'airbnb').length;
            const vrboCount = currentData.filter(p => p.pms === 'vrbo').length;
            const activeProperties = currentData.filter(p => !p.isHidden).length;
            const hiddenProperties = currentData.filter(p => p.isHidden).length;
            const pushEnabledProperties = currentData.filter(p => p.push_enabled).length;
            
            const avgBasePrice = currentData
                .filter(p => p.base && p.base !== "Unavailable")
                .reduce((sum, p) => sum + p.base, 0) / currentData.filter(p => p.base && p.base !== "Unavailable").length;

            const summaryHtml = `
                <div class="summary-card">
                    <h3>${totalProperties}</h3>
                    <p>Total Properties</p>
                </div>
                <div class="summary-card">
                    <h3>${airbnbCount} / ${vrboCount}</h3>
                    <p>Airbnb / VRBO</p>
                </div>
                <div class="summary-card">
                    <h3>${activeProperties}</h3>
                    <p>Active Listings</p>
                </div>
                <div class="summary-card">
                    <h3>${hiddenProperties}</h3>
                    <p>Hidden Listings</p>
                </div>
                <div class="summary-card">
                    <h3>${pushEnabledProperties}</h3>
                    <p>Push Enabled</p>
                </div>
                <div class="summary-card">
                    <h3>${formatCurrency(Math.round(avgBasePrice))}</h3>
                    <p>Avg Base Price</p>
                </div>
            `;
            
            document.getElementById('summaryCards').innerHTML = summaryHtml;
        }

        // Display properties
        function displayProperties() {
            const propertiesHtml = filteredData.map(property => {
                const mpiClass = getMPIClass(property.mpi_next_30);
                const revenueChange = getChangeArrow(property.revenue_past_30, property.stly_revenue_past_30);
                const revenuePercentChange = calculatePercentageChange(property.revenue_past_30, property.stly_revenue_past_30);
                
                return `
                    <div class="property-card">
                        <div class="property-header">
                            <div class="property-name">
                                ${property.name}
                                <span class="pms-badge pms-${property.pms}">${property.pms.toUpperCase()}</span>
                            </div>
                            <div class="property-location">
                                ${property.city_name}, ${property.state}
                            </div>
                        </div>
                        <div class="property-body">
                            <div class="property-details">
                                <div class="detail-item">
                                    <div class="detail-label">Bedrooms</div>
                                    <div class="detail-value">${property.no_of_bedrooms || '—'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Base Price</div>
                                    <div class="detail-value">${formatCurrency(property.base)}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Last Booked</div>
                                    <div class="detail-value">${property.last_booked_date ? new Date(property.last_booked_date).toLocaleDateString() : '—'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Booking Pickup</div>
                                    <div class="detail-value">${property.booking_pickup_past_30 || '—'}</div>
                                </div>
                            </div>
                            
                            <div class="status-indicators">
                                <span class="status-badge ${property.isHidden ? 'status-hidden' : 'status-active'}">
                                    ${property.isHidden ? 'Hidden' : 'Active'}
                                </span>
                                <span class="status-badge ${property.push_enabled ? 'status-push-enabled' : 'status-push-disabled'}">
                                    Push ${property.push_enabled ? 'Enabled' : 'Disabled'}
                                </span>
                            </div>
                            
                            <div class="performance-indicators">
                                <div class="mpi-indicator">
                                    <div class="mpi-value ${mpiClass}">
                                        ${property.mpi_next_30 || '—'}
                                    </div>
                                    <div class="detail-label">MPI (30-day)</div>
                                </div>
                                
                                <div class="revenue-comparison">
                                    <div class="revenue-item">
                                        <div class="revenue-label">Revenue (30d)</div>
                                        <div class="revenue-value">
                                            ${formatCurrency(property.revenue_past_30)}
                                            ${revenueChange}
                                        </div>
                                        ${revenuePercentChange}
                                    </div>
                                    <div class="revenue-item">
                                        <div class="revenue-label">STLY Revenue</div>
                                        <div class="revenue-value">${formatCurrency(property.stly_revenue_past_30)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('propertiesGrid').innerHTML = propertiesHtml;
        }

        // Generate analytics data
        function generateAnalytics() {
            // Top performers table
            const topPerformers = [...currentData]
                .filter(p => p.mpi_next_30 && p.mpi_next_30 !== "Unavailable")
                .sort((a, b) => b.mpi_next_30 - a.mpi_next_30)
                .slice(0, 5);
            
            const topPerformersHtml = topPerformers.map(property => `
                <tr>
                    <td>${property.name.length > 40 ? property.name.substring(0, 40) + '...' : property.name}</td>
                    <td class="${getMPIClass(property.mpi_next_30)}">${property.mpi_next_30}</td>
                    <td>${formatCurrency(property.revenue_past_30)}</td>
                </tr>
            `).join('');
            
            document.getElementById('topPerformersBody').innerHTML = topPerformersHtml;
        }

        // Generate revenue matrix
        function generateRevenueMatrix() {
            const revenueCards = currentData.map(property => {
                const revenueChange = calculatePercentageChange(property.revenue_past_30, property.stly_revenue_past_30);
                const arrow = getChangeArrow(property.revenue_past_30, property.stly_revenue_past_30);
                
                return `
                    <div class="property-card" style="margin-bottom: 20px;">
                        <div class="property-header">
                            <div class="property-name">${property.name.length > 50 ? property.name.substring(0, 50) + '...' : property.name}</div>
                        </div>
                        <div class="property-body">
                            <div class="revenue-comparison">
                                <div class="revenue-item">
                                    <div class="revenue-label">Current (30d)</div>
                                    <div class="revenue-value">${formatCurrency(property.revenue_past_30)} ${arrow}</div>
                                </div>
                                <div class="revenue-item">
                                    <div class="revenue-label">STLY (30d)</div>
                                    <div class="revenue-value">${formatCurrency(property.stly_revenue_past_30)}</div>
                                </div>
                            </div>
                            ${revenueChange}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('revenueMatrix').innerHTML = revenueCards;
        }

        // Generate operational data
        function generateOperationalData() {
            const pushEnabled = currentData.filter(p => p.push_enabled).length;
            const pushDisabled = currentData.filter(p => !p.push_enabled).length;
            const recentlyPushed = currentData.filter(p => {
                if (!p.last_date_pushed) return false;
                const pushDate = new Date(p.last_date_pushed);
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                return pushDate > yesterday;
            }).length;
            
            const dataIssues = currentData.filter(p => {
                return !p.last_refreshed_at || 
                       p.recommended_base_price === "Unavailable" ||
                       p.mpi_next_30 === null;
            }).length;
            
            document.getElementById('pushStatusOverview').innerHTML = `
                <div class="revenue-comparison">
                    <div class="revenue-item">
                        <div class="revenue-label">Push Enabled</div>
                        <div class="revenue-value">${pushEnabled}</div>
                    </div>
                    <div class="revenue-item">
                        <div class="revenue-label">Push Disabled</div>
                        <div class="revenue-value">${pushDisabled}</div>
                    </div>
                    <div class="revenue-item">
                        <div class="revenue-label">Recently Pushed</div>
                        <div class="revenue-value">${recentlyPushed}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('dataQualityIssues').innerHTML = `
                <div class="revenue-item">
                    <div class="revenue-label">Properties with Data Issues</div>
                    <div class="revenue-value">${dataIssues}</div>
                </div>
                <p style="margin-top: 15px; color: #7f8c8d; font-size: 0.9rem;">
                    Issues include missing refresh timestamps, unavailable recommended prices, or null MPI values.
                </p>
            `;
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Filter functionality
        function filterProperties() {
            const searchTerm = document.querySelector('.search-box').value.toLowerCase();
            const pmsFilter = document.getElementById('pmsFilter').value;
            const bedroomsFilter = document.getElementById('bedroomsFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            filteredData = currentData.filter(property => {
                const matchesSearch = property.name.toLowerCase().includes(searchTerm) ||
                                    property.city_name.toLowerCase().includes(searchTerm) ||
                                    property.state.toLowerCase().includes(searchTerm);
                
                const matchesPMS = !pmsFilter || property.pms === pmsFilter;
                
                const matchesBedrooms = !bedroomsFilter || 
                                      (bedroomsFilter === '5+' && property.no_of_bedrooms >= 5) ||
                                      property.no_of_bedrooms == bedroomsFilter;
                
                const matchesStatus = !statusFilter ||
                                    (statusFilter === 'active' && !property.isHidden) ||
                                    (statusFilter === 'hidden' && property.isHidden);
                
                return matchesSearch && matchesPMS && matchesBedrooms && matchesStatus;
            });
            
            displayProperties();
        }

        // Initialize the dashboard when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>